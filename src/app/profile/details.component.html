<h1 class="text-center mb-4 text-primary font-weight-bold">My Profile</h1>

<!-- Account Details Section -->
<h2 class="text-secondary mb-4">Account Details</h2>
<div *ngIf="account" class="card shadow-lg p-4 mb-4">
    <div class="mb-3">
        <strong>Name: </strong> {{ account.firstName }} {{ account.lastName }}<br />
        <strong>Email: </strong> {{ account.email }}<br />
        <strong>Phone Number: </strong> {{ account.phoneNumber }}<br />
        <strong>Role: </strong> {{ account.role }}<br />
    </div>
    <!-- Update Profile Button -->
    <div class="text-left">
        <a routerLink="update" class="btn btn-success btn-lg text-white rounded-pill shadow-sm">Update Profile</a>
    </div>
</div>

<!-- Branch Information Card -->
<div *ngIf="isManager()" class="card shadow-lg p-4 mb-4 position-relative">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h3 class="text-dark">Branch Information</h3>
        <button (click)="toggleBranchInfo()" class="btn btn-info btn-sm rounded-pill">
            {{ showBranchInfo ? 'Hide Branch Information' : 'Show Branch Information' }}
        </button>
    </div>
    <!-- Branch Info Display -->
    <div *ngIf="showBranchInfo" class="mt-3">
        <div class="card p-4 bg-light shadow-sm">
            <!-- ✅ Use safe null check -->
            <strong>Branch: </strong> {{ gradeLevel && gradeLevel.id ? gradeLevel.id : 'No Branch Assigned' }}<br />
            <!-- <strong>Location: </strong> {{ gradeLevel?.location || 'N/A' }}<br />
            <strong>Status: </strong> {{ branch?.branchStatus || 'N/A' }} -->
        </div>
    </div>
</div>

<!-- Activity Logs Card -->
<div class="card shadow-lg p-4 mb-4 position-relative">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h3 class="text-dark">Activity Logs</h3>
        <button (click)="toggleActivityLogs()" class="btn btn-info btn-sm rounded-pill">
            {{ showActivityLogs ? 'Hide Activity Logs' : 'Show Activity Logs' }}
        </button>
    </div>
    <!-- Activity Logs Table -->
    <div *ngIf="showActivityLogs">
        <!-- Start and End Date Filters -->
        <div class="row g-3 mb-4">
            <div class="col-md-4">
                <label for="actionType">Action Type Search:</label>
                <input
                    type="text"
                    id="actionType"
                    class="form-control rounded-pill shadow-sm"
                    placeholder="Search by action type..."
                    [(ngModel)]="searchTerm"
                    (input)="handleSearch()"
                />
            </div>
            <div class="col-md-4">
                <label for="startDate">Start Date:</label>
                <input
                    type="datetime-local"
                    id="startDate"
                    class="form-control rounded-pill shadow-sm"
                    [(ngModel)]="startDate"
                    (change)="handleSearch()"
                />
            </div>
            <div class="col-md-4">
                <label for="endDate">End Date:</label>
                <input
                    type="datetime-local"
                    id="endDate"
                    class="form-control rounded-pill shadow-sm"
                    [(ngModel)]="endDate"
                    (change)="handleSearch()"
                />
            </div>
        </div>

        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead>
                    <tr>
                        <th>Action Type</th>
                        <th>Details</th>
                        <th>Timestamp</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let log of filteredLogs">
                        <td>{{ log.actionType }}</td>
                        <td>{{ log.actionDetails }}</td>
                        <td>{{ log.timestamp | date:'MM/dd/yy, hh:mm a' }}</td>
                    </tr>
                    <tr *ngIf="filteredLogs.length === 0">
                        <td colspan="3" class="text-center text-muted">No activity logs found</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Admin Section for All Activity Logs -->
<div *ngIf="isAdmin()" class="card shadow-lg p-4 mb-4 position-relative">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h3 class="text-dark">All Activity Logs (Admin Only)</h3>
        <button (click)="toggleAllActivityLogs()" class="btn btn-info btn-sm rounded-pill">
            {{ showAllActivityLogs ? 'Hide All Logs' : 'Show All Logs' }}
        </button>
    </div>

    <div *ngIf="showAllActivityLogs">
        <div class="row g-3 mb-4">
            <div class="col-md-4">
                <label for="adminActionType">Action type:</label>
                <input [(ngModel)]="adminSearchTerm" (input)="handleAdminSearch()" placeholder="Search all logs Actions" class="form-control rounded-pill shadow-sm" />
            </div>
            <div class="col-md-4">
                <label for="adminStartDate">Start Date:</label>
                <input [(ngModel)]="adminStartDate" (change)="handleAdminSearch()" type="datetime-local" class="form-control rounded-pill shadow-sm" />
            </div>
            <div class="col-md-4">
                <label for="adminEndDate">End Date:</label>
                <input [(ngModel)]="adminEndDate" (change)="handleAdminSearch()" type="datetime-local" class="form-control rounded-pill shadow-sm" />
            </div>
        </div>

        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead>
                    <tr>
                        <th>Action Type</th>
                        <th>User</th>
                        <th>Details</th>
                        <th>Timestamp</th>
                    </tr>
                </thead>
                
                <tbody>
                    <tr *ngFor="let log of filteredAllLogs">
                        <td>{{ log.actionType }}</td>
                        <td>{{ log.userEmail }} ({{ log.userRole }})</td>
                        <td>{{ log.actionDetails }}</td>
                        <td>{{ log.timestamp | date:'MM/dd/yy, hh:mm a' }}</td>
                    </tr>
                    <tr *ngIf="filteredAllLogs.length === 0">
                        <td colspan="4" class="text-center text-muted">No activity logs found</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
