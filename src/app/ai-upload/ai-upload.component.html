<!-- ai-upload.component.html -->
<style>
  .questions-panel {
    max-height: 400px;
    overflow-y: auto;
    background-color: #f8f9fa;
    padding: 15px;
    border-radius: 5px;
  }

  .questions-panel h6 {
    font-weight: 600;
  }

  .list-group-item {
    padding: 5px 10px;
    font-size: 0.95rem;
  }

  .btn-download {
    float: right;
  }

  .card-title {
    font-size: 1.75rem;
    font-weight: 700;
  }
</style>

<div class="container my-5">
  <div class="card shadow-sm bg-light">
    <div class="card-body">
      <h3 class="card-title mb-4 text-center">AI PDF Question Generator</h3>

      <!-- Grade Level & Subject Selectors -->
      <div class="row g-3 mb-3">
        <div class="col-md-6">
          <label for="gradeLevel" class="form-label">Grade Level</label>
          <select id="gradeLevel" class="form-select" [(ngModel)]="selectedGradeLevelId" (change)="onGradeLevelChange()">
            <option value="">Select Grade Level</option>
            <option *ngFor="let g of gradeLevels" [value]="g.id">{{ g.name }}</option>
          </select>
        </div>
        <div class="col-md-6">
          <label for="subject" class="form-label">Subject</label>
          <select id="subject" class="form-select" [(ngModel)]="selectedSubjectId" (change)="onSubjectChange()">
            <option value="">Select Subject</option>
            <option *ngFor="let s of subjects" [value]="s.id">{{ s.name }}</option>
          </select>
        </div>
      </div>

      <!-- File Upload -->
      <div class="row g-3 mb-3 align-items-end">
        <div class="col-md-8">
          <label for="fileUpload" class="form-label">Upload PDF</label>
          <input type="file" class="form-control" id="fileUpload" (change)="onFileSelected($event)" />
        </div>
        <div class="col-md-4 d-grid">
          <button class="btn btn-primary mt-2" (click)="generateQuestions()" [disabled]="loading">
            {{ loading ? 'Generating...' : 'Generate Questions' }}
          </button>
        </div>
      </div>

      <!-- Error Message -->
      <div *ngIf="errorMsg" class="alert alert-danger mt-2">{{ errorMsg }}</div>

      <!-- ✅ Success Message / Indicator -->
      <div *ngIf="successMsg" class="alert alert-success mt-2">
        {{ successMsg }}
      </div>

      <!-- Download Button -->
      <div *ngIf="downloadUrl" class="text-end mb-3">
        <button class="btn btn-success btn-download" (click)="downloadPDF()">
          <i class="bi bi-download"></i> Download PDF
        </button>
      </div>

      <!-- Questions Panel -->
      <div *ngIf="generatedQuestions.length > 0" class="questions-panel">
        <div *ngFor="let q of generatedQuestions; let i = index" class="mb-3">
          <h6>{{ i + 1 }}. {{ q.question }}</h6>
          <ul class="list-group list-group-flush">
            <li class="list-group-item">A. {{ q.options.A }}</li>
            <li class="list-group-item">B. {{ q.options.B }}</li>
            <li class="list-group-item">C. {{ q.options.C }}</li>
            <li class="list-group-item">D. {{ q.options.D }}</li>
          </ul>
        </div>
      </div>

      <!-- ✅ List of Generated PDFs -->
      <div *ngIf="generatedPDFs.length > 0" class="mt-4">
        <h5>Generated PDFs</h5>
        <ul class="list-group">
          <li *ngFor="let pdf of generatedPDFs" class="list-group-item d-flex justify-content-between align-items-center">
            {{ pdf.filePath.split('/').pop() }}
            <a class="btn btn-sm btn-outline-primary"
               [href]="'http://localhost:5000' + pdf.downloadUrl"
               target="_blank">
               Download
            </a>
          </li>
        </ul>
      </div>

    </div>
  </div>
</div>